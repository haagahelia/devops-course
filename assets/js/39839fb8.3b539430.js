"use strict";(self.webpackChunkdevops=self.webpackChunkdevops||[]).push([[423],{2626:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/failed_test-39da4c2338edcf89752116d6d8baa0e9.png"},2717:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/auto_deploy-c1906e88ebd40fb26c7f91b59c0b9a71.png"},3298:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"deployment/deployment","title":"CD pipeline","description":"Deployment","source":"@site/docs/deployment/deployment.md","sourceDirName":"deployment","slug":"/deployment/","permalink":"/devops-course/docs/deployment/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deployment/deployment.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"CD pipeline"},"sidebar":"tutorialSidebar","previous":{"title":"Deployment & Delivery","permalink":"/devops-course/docs/deployment/general"},"next":{"title":"Versioning","permalink":"/devops-course/docs/deployment/versioning"}}');var o=n(4848),i=n(8453);const r={sidebar_position:2,title:"CD pipeline"},d=void 0,l={},a=[{value:"Deployment",id:"deployment",level:3},{value:"CI/CD Pipeline",id:"cicd-pipeline",level:3},{value:"Further reading",id:"further-reading",level:3}];function c(e){const t={a:"a",code:"code",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h3,{id:"deployment",children:"Deployment"}),"\n",(0,o.jsxs)(t.p,{children:["We will do our first deployment to Render.com (",(0,o.jsx)(t.a,{href:"https://render.com",children:"https://render.com"}),") that provides free Hobby plan for small-scale applications. There are some limitations in free plan that you should be aware. The deployments are much slower when using free plan and free instances will spin down with inactivity, which can delay requests by 50 seconds or more. We are going to deploy the Node Express app that we used in the CI pipelines chapter earlier."]}),"\n",(0,o.jsxs)(t.p,{children:["First, you have to create an account to Render.com in ",(0,o.jsx)(t.a,{href:"https://dashboard.render.com/register",children:"https://dashboard.render.com/register"}),". After you have sign-in to Render, select ",(0,o.jsx)(t.strong,{children:"New --\x3e Web Service"})," in your workspace."]}),"\n",(0,o.jsxs)(t.p,{children:["Next, you can select public GitHub repository where your project is hosted and press the ",(0,o.jsx)(t.strong,{children:"Connect"})," button."]}),"\n",(0,o.jsx)(t.p,{children:"In the web service form, fill in the following details:"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Field"}),(0,o.jsx)(t.th,{children:"Value"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Language"}),(0,o.jsx)(t.td,{children:"Node"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Branch"}),(0,o.jsx)(t.td,{children:"main"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Build command"}),(0,o.jsx)(t.td,{children:"npm install"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"Start command"}),(0,o.jsx)(t.td,{children:"npm start"})]})]})]}),"\n",(0,o.jsxs)(t.p,{children:["In the Instance Type select ",(0,o.jsx)(t.strong,{children:"Free"})," option"]}),"\n",(0,o.jsxs)(t.p,{children:["Finally, press the ",(0,o.jsx)(t.strong,{children:"Deploy"})," button. After the deployment starts, you will be redirected to a page where you can see the deployment log. Wait until, you get the message that your service is live:"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Render.com deployment log",src:n(8696).A+"",width:"840",height:"364"})}),"\n",(0,o.jsx)(t.p,{children:"As you can see the deployment to modern hosting providers is really straigthforward."}),"\n",(0,o.jsxs)(t.p,{children:["By default, Render automatically deploys your service whenever you update its code in linked GitHub repository. Opent the ",(0,o.jsx)(t.code,{children:"app.ts"})," file and change the message that is displayed when you navigate to the root endpoint:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",children:"app.get('/', (req, res) => {\n  res.json({ message: 'Calculator API is running on Render.com' });\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:"Push your changes to the repository and see that the GitHub actions workflow fails."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Failed test",src:n(2626).A+"",width:"1042",height:"313"})}),"\n",(0,o.jsxs)(t.p,{children:["One of the tests does not pass, yet the application is still automatically deployed to Render.com. ",(0,o.jsx)(t.strong,{children:"Deployments should only occur after all linting and tests have successfully passed."}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"cicd-pipeline",children:"CI/CD Pipeline"}),"\n",(0,o.jsxs)(t.p,{children:["In this phase we will modify our GitHub actions workflow so that deployment is done only after linting and tests are passed. We will use web hooks to trigger deployment after linting and tests are passed. If you are not familiar with web hooks you can read more ",(0,o.jsx)(t.a,{href:"https://www.redhat.com/en/topics/automation/what-is-a-webhook",children:"here"}),". The instructions to use web hooks for the deployment in Render.com can be found ",(0,o.jsx)(t.a,{href:"https://render.com/docs/deploy-hooks",children:"here"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["First, we will disable automatic deployment from the Render.com web service. Navigate to the settings page of your web service and select ",(0,o.jsx)(t.strong,{children:"No"})," from the ",(0,o.jsx)(t.strong,{children:"Auto-Deploy"}),"."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Auto deployment",src:n(2717).A+"",width:"1254",height:"169"})}),"\n",(0,o.jsxs)(t.p,{children:["Next, we have to get hook url. Navigate to your Render.com web service's settings and scroll down to ",(0,o.jsx)(t.strong,{children:"Deploy Hook"}),". Copy your private hook url and remember to keep that secret."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Deploy hook",src:n(6297).A+"",width:"1255",height:"205"})}),"\n",(0,o.jsxs)(t.p,{children:["To securely use the deployment hook URL in your GitHub Actions workflow, you should store it as a secret. Navigate to your repository's settings, and from the left-side menu, select ",(0,o.jsx)(t.strong,{children:"Secrets and variables"}),". Create a new ",(0,o.jsx)(t.strong,{children:"Repository secret"}),", name it ",(0,o.jsx)(t.code,{children:"RENDER_DEPLOY_HOOK_URL"}),", and paste the deployment hook URL you copied from Render.com into the secret value field. Finally, click the ",(0,o.jsx)(t.strong,{children:"Add Secret"})," button to save it."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Github secrets",src:n(7332).A+"",width:"1657",height:"372"})}),"\n",(0,o.jsxs)(t.p,{children:["You can read more about secrets ",(0,o.jsx)(t.a,{href:"https://docs.github.com/en/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions",children:"here"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"Now, we can  modify our Github actions workflow. Add the following Deploy step in your GitHub Actions workflow. It is responsible for triggering a deployment to the Render.com using a deployment hook URL."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:"# Node.js CI/CD pipeline\nname: Node.js CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n    \njobs:\n  Node-ci-pipeline:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with: \n          node-version: '20'\n      - name: Install dependencies\n        run: npm ci\n      - name: Linting\n        run: npm run lint\n      - name: Build\n        run: npm run build\n      - name: Run tests\n        run: npm run test\n      //highlight-start\n      # Deployment to Render.com\n      - name: Deploy\n        env:\n          deploy_url: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}\n        run: |\n          curl \"$deploy_url\"   \n     //highlight-end\n"})}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["The ",(0,o.jsx)(t.code,{children:"deploy_url"})," is set using a secret stored in your GitHub repository (",(0,o.jsx)(t.code,{children:"RENDER_DEPLOY_HOOK_URL"}),").\nSecrets are securely stored and not exposed in logs, ensuring sensitive information like deployment URLs or API keys remains protected."]}),"\n",(0,o.jsxs)(t.li,{children:["The ",(0,o.jsx)(t.code,{children:"curl"})," command is used to make an HTTP request to the deployment hook URL (",(0,o.jsx)(t.code,{children:"$deploy_url"}),").\nThis triggers a deployment process on a Render, which listens for such hooks to start deploying the latest version of your application."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Once the deployment is triggered, navigate to the ",(0,o.jsx)(t.strong,{children:"Events"})," section in your Render.com web service dashboard. Here, you should see a new deployment event. After the deployment completes, the latest version of your application will be live."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"further-reading",children:"Further reading"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://docs.github.com/en/actions/about-github-actions/about-continuous-deployment-with-github-actions",children:"https://docs.github.com/en/actions/about-github-actions/about-continuous-deployment-with-github-actions"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},6297:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/deploy_hook-92ce2bb037e056af7c5092eb26db0586.png"},7332:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/github_secret-65c212cec72a1879df0f47025659dd25.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>d});var s=n(6540);const o={},i=s.createContext(o);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:t},e.children)}},8696:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/deployment_log-e473107d0ba98c8fdfba34131e3a447d.png"}}]);