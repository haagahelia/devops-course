"use strict";(self.webpackChunkdevops=self.webpackChunkdevops||[]).push([[765],{958:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"automating/cipipeline","title":"CI Pipelines","description":"CI workflow","source":"@site/docs/automating/cipipeline.md","sourceDirName":"automating","slug":"/automating/cipipeline","permalink":"/devops-course/docs/automating/cipipeline","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/automating/cipipeline.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"CI Pipelines"},"sidebar":"tutorialSidebar","previous":{"title":"Writing workflows","permalink":"/devops-course/docs/automating/workflows"},"next":{"title":"Write actions","permalink":"/devops-course/docs/automating/writeactions"}}');var i=t(4848),o=t(8453);const r={sidebar_position:4,title:"CI Pipelines"},a=void 0,l={},c=[{value:"CI workflow",id:"ci-workflow",level:3},{value:"Matrices",id:"matrices",level:3},{value:"Status badge",id:"status-badge",level:3},{value:"Further reading",id:"further-reading",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"ci-workflow",children:"CI workflow"}),"\n",(0,i.jsx)(n.p,{children:"In this section, we will implement simple CI workflow to lint, build and test the Node.js app."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Fork the app from this ",(0,i.jsx)(n.a,{href:"https://github.com/juhahinkula/ci-training.git",children:"repository"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This is a Node.js Express calculator application. You can start the app using the ",(0,i.jsx)(n.code,{children:"npm run start"})," command. By default, it listens on port 3000. To perform calculations, send a POST request to the ",(0,i.jsx)(n.code,{children:"/calculate"})," endpoint. The request body should include the operation (add, subtract, multiply, or divide) and two numbers (",(0,i.jsx)(n.code,{children:"a"})," and ",(0,i.jsx)(n.code,{children:"b"}),"). The response will return the result of the calculation."]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Clone the forked repository to your computer."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Install the dependencies, start the application, and verify that it functions correctly."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"./github/workflows/ci_workflow.yaml"})," file"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Now, we are ready to write our workflow file. First we define a name of the workflow. The event that executes workflow is push and merge a branch to the main branch:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Node.js CI pipeline\nname: Node.js CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n"})}),"\n",(0,i.jsx)(n.p,{children:"Next, we define jobs for our workflow. The jobs will be run on the latest version of ubuntu."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Node.js CI pipeline\nname: Node.js CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  Node-ci-pipeline:\n    runs-on: ubuntu-latest\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then we have to define steps for the ",(0,i.jsx)(n.code,{children:"Node-ci-pipeline"})," job. Github provides pre-defined ",(0,i.jsx)(n.strong,{children:"actions"})," for specific purposes. Actions are pre-defined set of jobs or code that perform specific task. You can explore different actions in ",(0,i.jsx)(n.a,{href:"https://github.com/marketplace?type=actions",children:"Github marketplace"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"checkout"})," action is responsible for checkout your repository so that the workflow can access its contents. The ",(0,i.jsx)(n.code,{children:"setup-node"})," action is used to configure the specified version of Node.js on the runner. The ",(0,i.jsx)(n.code,{children:"@4"})," indicates the version of the action being used. The ",(0,i.jsx)(n.code,{children:"with"})," keyword allows you to define additional parameters, such as the Node.js version."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Node.js CI pipeline\nname: Node.js CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  Node-ci-pipeline:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with: \n          node-version: '20'\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now, we are ready to perform linting, build, and testing. First, we will use the ",(0,i.jsx)(n.code,{children:"npm ci"})," command to install dependencies in a clean environment. After the dependencies are installed, we will build the Node.js application and then execute the tests."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Node.js CI pipeline\nname: Node.js CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  Node-ci-pipeline:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with: \n          node-version: '20'\n      - name: Install dependencies\n        run: npm ci\n      - name: Linting\n        run: npm run lint\n      - name: Build\n        run: npm run build\n      - name: Run tests\n        run: npm run test\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"npm ci"})," command installs exactly what's in the ",(0,i.jsx)(n.code,{children:"lock"})," file with no deviations. That guarantees the same dependencies across all environments. It requires that ",(0,i.jsx)(n.code,{children:"lock"})," file exists and it removes existing ",(0,i.jsx)(n.code,{children:"node_modules"})," folder before installation. It is faster than ",(0,i.jsx)(n.code,{children:"npm install"})," in clean environments (CI piplines). Read more in ",(0,i.jsx)(n.a,{href:"https://docs.npmjs.com/cli/v8/commands/npm-ci",children:"https://docs.npmjs.com/cli/v8/commands/npm-ci"})]})}),"\n",(0,i.jsxs)(n.p,{children:["Commit changes to your local repository and push changes to Github repository. If you open the ",(0,i.jsx)(n.strong,{children:"Actions"})," tab of your repository, you should see the workflow running."]}),"\n",(0,i.jsxs)(n.admonition,{title:"Task: Fix errors",type:"info",children:[(0,i.jsx)(n.p,{children:"The workflow may initially fail due to issues in linting or testing."}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Linting errors",src:t(3922).A+"",width:"1453",height:"748"})}),(0,i.jsx)(n.p,{children:"Identify and resolve these errors to ensure the workflow completes successfully with a green status."})]}),"\n",(0,i.jsx)(n.h3,{id:"matrices",children:"Matrices"}),"\n",(0,i.jsxs)(n.p,{children:["In GitHub Actions, ",(0,i.jsx)(n.strong,{children:"matrices"})," are a feature that allows you to run multiple variations of a job in parallel. This is particularly useful for testing your code across different environments, such as multiple versions of a programming language, operating systems, or configurations."]}),"\n",(0,i.jsxs)(n.admonition,{title:"TASK: Define matrix",type:"info",children:[(0,i.jsxs)(n.p,{children:["Read the ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/running-variations-of-jobs-in-a-workflow",children:"matrix documentation"})," and modify the CI workflow that we have made. The workflow should run using both the Node versions 20 and 22 and the latest ubuntu and windows versions. You should see 4 jobs executed in the workflow:"]}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Worflow matrix",src:t(8807).A+"",width:"495",height:"463"})})]}),"\n",(0,i.jsx)(n.h3,{id:"status-badge",children:"Status badge"}),"\n",(0,i.jsxs)(n.p,{children:["You can display a status badge in your repository to indicate the status of your workflows. Read the instructions in the ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/monitoring-workflows/adding-a-workflow-status-badge",children:"Github documentation"})," and add a status badge to your repository."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Worflow badge",src:t(6835).A+"",width:"841",height:"231"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"further-reading",children:"Further reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/features/actions",children:"https://github.com/features/actions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://fullstackopen.com/en/part11/getting_started_with_git_hub_actions",children:"https://fullstackopen.com/en/part11/getting_started_with_git_hub_actions"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["MISS\xc4 T\xc4M\xc4 K\xc4SITELL\xc4\xc4N: - ",(0,i.jsx)(n.a,{href:"https://www.youtube.com/watch?v=vMhDkt5JNN0",children:"https://www.youtube.com/watch?v=vMhDkt5JNN0"})," / Secrets"]}),"\n",(0,i.jsxs)(n.p,{children:["SHOW BADGE: ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/monitoring-workflows/adding-a-workflow-status-badge",children:"https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/monitoring-workflows/adding-a-workflow-status-badge"})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3922:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/linter_errors-764ace4644c9fb04172a3c8b5db3f7d9.png"},6835:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/badge-bb72e72a2a28c131092a52bf29398240.png"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},8807:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/matrix-cddb65a7576969d660f792ee385a0ba3.png"}}]);